<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wangqin.globalshop.channel.dal.mapperExt.CAInventoryDOMapperExt" >

    <select id="queryInventoryByCode" resultMap="com.wangqin.globalshop.biz1.app.dal.mapper.InventoryDOMapper.BaseResultMap"  >
        SELECT
        <include refid="com.wangqin.globalshop.biz1.app.dal.mapper.InventoryDOMapper.Base_Column_List" />
        FROM
        inventory T1
        <where>
            <if test="itemCode != null" >
                item_code = #{itemCode}
            </if>
            <if test="skuCode != null" >
                and sku_code = #{skuCode}
            </if>
        </where>
    </select>

    <update id="updateLockInventory" >
    <![CDATA[
	    UPDATE
	    		inventory
	    	SET
			locked_inv = locked_inv + #{booked},
			locked_trans_inv = locked_trans_inv + #{transBooked}
	    WHERE
	    		id = #{id} and inventory - #{booked} >=0  and inventory >= locked_inv + #{booked}
	    				   and trans_inv - #{transBooked} >=0  and trans_inv >= locked_trans_inv + #{transBooked}
	    		]]>
	</update>



</mapper>
