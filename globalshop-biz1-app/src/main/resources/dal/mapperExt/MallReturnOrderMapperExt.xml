<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wangqin.mapper.ErpReturnOrderMapper">

	<!-- 通用查询结果列-->
    <sql id="Base_Column_List">
		T1.`id`,T1.`order_no` AS orderNo,T1.`outer_order_id` AS outerOrderId,T1.`erp_no` AS erpNo,T1.`erp_order_id` AS erpOrderId,T1.`status`,T1.`return_reason` AS returnReason,T1.`return_reason_detail` AS returnReasonDetail,T1.`return_quantity` AS returnQuantity,T1.`return_price` AS returnPrice,T1.`return_type` as returnType,T1.`return_refer` as returnRefer,T1.`proof_img` as proofImg,T1.`telephone`,T1.`is_gn` AS isGn,T1.`is_checkin` AS isCheckin,T1.`user_create` AS userCreate,
  		T1.`user_modify` AS userModify,T1.`receive_time` AS receiveTime,T1.`return_pay_time` AS returnPayTime,T1.`remark`,T1.`gmt_create` AS gmtCreate,T1.`gmt_modify` AS gmtModify
	</sql>

	<select id="queryErpReturnOrdersCount" resultType="java.lang.Integer"  parameterType="com.wangqin.vo.ErpReturnOrderQueryVO">
        SELECT
        	count(1)
        FROM
            `erp_return_order` T1 LEFT JOIN `erp_order` T2 ON T1.outer_order_id=T2.id 
        WHERE 1=1 
            <if test="status != null">
                and T1.status = #{status}
            </if>
            <if test="orderNo!=null and orderNo!=''">
             	and T1.order_no LIKE concat('%',#{orderNo},'%')
            </if>
            <if test="erpNo!=null and erpNo!=''">
             	and T1.erp_no LIKE concat('%',#{erpNo},'%')
            </if>
            <if test="upc!=null and upc!=''">
             	and T2.upc = #{upc} 
            </if>
            <if test="returnReason!=null and returnReason!=''">
             	and T1.return_reason = #{returnReason}
            </if>
            <if test="skuCode!=null and skuCode!=''">
             	and T2.sku_code = #{skuCode} 
            </if>
            <if test="itemName!=null and itemName!=''">
             	and T2.item_name LIKE concat('%',#{itemName},'%')
            </if>
            <if test="salesName!=null and salesName!=''">
             	and T2.sales_name = #{salesName} 
            </if>
            <if test="returnType!=null">
            	and T1.return_type = #{returnType} 
            </if>
            <if test="returnRefer!=null">
            	and T1.return_refer = #{returnRefer} 
            </if>
            <if test=" startGmtCreate!= null ">
             	and   <![CDATA[ T1.gmt_create >= #{startGmtCreate} ]]>
            </if>
            <if test=" endGmtCreate != null ">
            	and    <![CDATA[ T1.gmt_create <= #{endGmtCreate} ]]>
            </if>
    </select>
    
    <select id="queryErpReturnOrders" resultType="com.wangqin.model.ErpReturnOrder" parameterType="com.wangqin.vo.ErpReturnOrderQueryVO">
        SELECT 
        	 <include refid="Base_Column_List" />,T2.sku_code AS skuCode,T2.upc,T2.item_name AS itemName,T2.sku_pic AS skuPic, T2.sales_name as salesName 
        FROM 
            `erp_return_order` T1 LEFT JOIN `erp_order` T2 ON T1.erp_order_id=T2.id 
        WHERE 1=1 
            <if test="status != null">
                and T1.status = #{status}
            </if>
            <if test="orderNo!=null and orderNo!=''">
             	and T1.order_no LIKE concat('%',#{orderNo},'%')
            </if>
            <if test="erpNo!=null and erpNo!=''">
             	and T1.erp_no LIKE concat('%',#{erpNo},'%')
            </if>
            <if test="upc!=null and upc!=''">
             	and T2.upc = #{upc} 
            </if>
            <if test="returnReason!=null and returnReason!=''">
             	and T1.return_reason = #{returnReason}
            </if>
            <if test="skuCode!=null and skuCode!=''">
             	and T2.sku_code = #{skuCode} 
            </if>
            <if test="itemName!=null and itemName!=''">
             	and T2.item_name LIKE concat('%',#{itemName},'%')
            </if>
            <if test="salesName!=null and salesName!=''">
             	and T2.sales_name = #{salesName} 
            </if>
            <if test="returnType!=null">
            	and T1.return_type = #{returnType} 
            </if>
            <if test="returnRefer!=null">
            	and T1.return_refer = #{returnRefer} 
            </if>
            <if test=" startGmtCreate!= null ">
             	and   <![CDATA[ T1.gmt_create >= #{startGmtCreate} ]]>
            </if>
            <if test=" endGmtCreate != null ">
            	and    <![CDATA[ T1.gmt_create <= #{endGmtCreate} ]]>
            </if>
          order by T1.gmt_create desc 
          	<![CDATA[ LIMIT #{firstStart},#{pageSize} ]]>
    </select>
    
    <select id="queryErpReturnOrderForExcel" resultType="com.wangqin.model.ErpReturnOrder" parameterType="com.wangqin.vo.ErpReturnOrderQueryVO">
    	SELECT
        	 <include refid="Base_Column_List" />, T2.upc, T2.item_name as itemName, T2.sku_code as skuCode, T2.sku_pic as skuPic, T2.sales_name as salesName
        FROM 
            `erp_return_order` T1 LEFT JOIN `erp_order` T2 ON T1.erp_order_id=T2.id 
        <where>
            <if test="itemName!=null and itemName!=''">
             	and T2.item_name LIKE concat('%',#{itemName},'%')
            </if>
            <if test="orderNo!=null and orderNo!=''">
             	and T1.order_no LIKE concat('%',#{orderNo},'%')
            </if>
            <if test="erpNo!=null and erpNo!=''">
             	and T1.erp_no LIKE concat('%',#{erpNo},'%')
            </if>
            <if test="skuCode!=null and skuCode!=''">
             	and T2.sku_code = #{skuCode} 
            </if>
            <if test="upc!=null and upc!=''">
             	and T2.upc = #{upc} 
            </if>
            <if test="returnReason != null and returnReason!=''">
               	and T1.return_reason = #{returnReason}
            </if>                        
            <if test="status != null">
                and T1.status = #{status}
            </if>                       
            <if test="salesName!=null and salesName!=''">
             	and T2.sales_name = #{salesName} 
            </if>
            <if test="returnType!=null">
            	and T1.return_type = #{returnType} 
            </if>
            <if test="returnRefer!=null">
            	and T1.return_refer = #{returnRefer} 
            </if>
            <if test=" startGmtCreate!= null ">
             	and   <![CDATA[ T1.gmt_create >= #{startGmtCreate} ]]>
            </if>
            <if test=" endGmtCreate != null ">
            	and    <![CDATA[ T1.gmt_create <= #{endGmtCreate} ]]>
            </if>                      
            
        </where>
          order by T1.gmt_create desc 
    </select>
</mapper>