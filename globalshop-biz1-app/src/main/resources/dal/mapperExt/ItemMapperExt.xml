<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wangqin.globalshop.biz1.app.dal.mapperExt.ItemDOMapperExt">
<!-- 商品模块的都在这里!!!! -->

   <!-- 通用查询结果列-->
    <sql id="Base_Column_List">
        T1.id,name,T1.status,T1.sale_on_youzan AS saleOnYouzan, T1.remark,T1.spec,T1.model,T1.category_id AS categoryId,T1.category_name AS categoryName,item_code AS itemCode,is_new AS isNew,sale_type AS saleType,main_pic AS mainPic,dimensioncode_pic AS dimensionCodePic,item_short AS itemShort,en_name AS enName,brand,country,currency,buy_site AS buySite,origin,weight,price_range as priceRange,unit,source,promotion,T1.contact_person AS contactPerson,T1.contact_tel AS contactTel,T1.id_card AS idCard,T1.start_date AS startDate,T1.end_date AS endDate,T1.is_sale AS isSale,T1.logistic_type as logisticType,T1.gmt_create AS gmtCreate,T1.gmt_modify AS gmtModify,T1.user_create AS userCreate,T1.user_modify AS userModify 
    </sql>
    <!-- 海狐查询结果列-->
    <sql id="Haihu_Column_List">
        T1.id,item_name AS itemName,T1.category_name AS categoryName,T1.item_code AS itemCode,T1.main_pic AS mainPic,T1.brand_no,T1.currency,T1.id_card AS idCard,T1.start_date AS startDate,T1.end_date AS endDate,T1.status As status
    </sql>
    <!-- 2.0版通用查询结果列,xiajun-->
    <sql id="Base_Column_List_2">
        T1.id,T1.item_name AS name,T1.status, T1.spec,T1.model,T1.country,T1.booking_date AS bookingDate,
        T1.category_name AS categoryName,T1.item_code AS itemCode,sale_type AS saleType,
        main_pic AS mainPic,qr_code_url AS dimensionCodePic,item_short AS itemShort,
        en_name AS enName,brand_name AS brand,currency,origin,weight,price_range as priceRange,
        unit,source,promotion,T1.id_card AS idCard,T1.detail,T1.start_date AS startDate,
        T1.end_date AS endDate,T1.is_sale AS isSale,T1.logistic_type as logisticType,
        T1.gmt_create AS gmtCreate,T1.gmt_modify AS gmtModify,T1.creator AS userCreate,
        T1.modifier AS userModify 
    </sql>
    
 
 	<select id="queryIdByItemCode" parameterType="java.lang.String" resultType="java.lang.Long">
 	select id from item
 	where item_code = #{itemCode}
 	</select>
 	
    <!-- 插入单个商品 -->
    <insert id="insertItemSelective" parameterType="com.wangqin.globalshop.biz1.app.dal.dataObject.ItemDO" >
    insert into item
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="itemCode != null" >
        item_code,
      </if>
      <if test="companyNo != null" >
        company_no,
      </if>
      <if test="categoryCode != null" >
        category_code,
      </if>
      <if test="qrCodeUrl != null" >
        qr_code_url,
      </if>
      <if test="video != null" >
        video,
      </if>
      <if test="subtitle != null" >
        subtitle,
      </if>
      <if test="itemName != null" >
        item_name,
      </if>
      <if test="enName != null" >
        en_name,
      </if>
      <if test="itemShort != null" >
        item_short,
      </if>
      <if test="categoryName != null" >
        category_name,
      </if>
      <if test="saleType != null" >
        sale_type,
      </if>
      <if test="mainPic != null" >
        main_pic,
      </if>
      <if test="brandNo != null" >
        brand_no,
      </if>
      <if test="brandName != null" >
        brand_name,
      </if>
      <if test="country != null" >
        country,
      </if>
      <if test="currency != null" >
        currency,
      </if>
      <if test="origin != null" >
        origin,
      </if>
      <if test="freight != null" >
        freight,
      </if>
      <if test="weight != null" >
        weight,
      </if>
      <if test="logisticType != null" >
        logistic_type,
      </if>
      <if test="priceRange != null" >
        price_range,
      </if>
      <if test="unit != null" >
        unit,
      </if>
      <if test="source != null" >
        source,
      </if>
      <if test="promotion != null" >
        promotion,
      </if>
      <if test="idCard != null" >
        id_card,
      </if>
      <if test="startDate != null" >
        start_date,
      </if>
      <if test="endDate != null" >
        end_date,
      </if>
      <if test="bookingDate != null" >
        booking_date,
      </if>
      <if test="isSale != null" >
        is_sale,
      </if>
      <if test="wxisSale != null" >
        wxis_sale,
      </if>
      <if test="isFind != null" >
        is_find,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="spec != null" >
        spec,
      </if>
      <if test="model != null" >
        model,
      </if>
      <if test="creator != null" >
        creator,
      </if>
      <if test="modifier != null" >
        modifier,
      </if>
      <if test="remark != null" >
        `remark`,
      </if>
      <if test="detail != null" >
        detail,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="itemCode != null" >
        #{itemCode,jdbcType=VARCHAR},
      </if>
      <if test="companyNo != null" >
        #{companyNo,jdbcType=VARCHAR},
      </if>
      <if test="categoryCode != null" >
        #{categoryCode,jdbcType=VARCHAR},
      </if>
      <if test="qrCodeUrl != null" >
        #{qrCodeUrl,jdbcType=VARCHAR},
      </if>
      <if test="video != null" >
        #{video,jdbcType=VARCHAR},
      </if>
      <if test="subtitle != null" >
        #{subtitle,jdbcType=VARCHAR},
      </if>
      <if test="itemName != null" >
        #{itemName,jdbcType=VARCHAR},
      </if>
      <if test="enName != null" >
        #{enName,jdbcType=VARCHAR},
      </if>
      <if test="itemShort != null" >
        #{itemShort,jdbcType=VARCHAR},
      </if>
      <if test="categoryName != null" >
        #{categoryName,jdbcType=VARCHAR},
      </if>
      <if test="saleType != null" >
        #{saleType,jdbcType=TINYINT},
      </if>
      <if test="mainPic != null" >
        #{mainPic,jdbcType=VARCHAR},
      </if>
      <if test="brandNo != null" >
        #{brandNo,jdbcType=VARCHAR},
      </if>
      <if test="brandName != null" >
        #{brandName,jdbcType=VARCHAR},
      </if>
      <if test="country != null" >
        #{country,jdbcType=TINYINT},
      </if>
      <if test="currency != null" >
        #{currency,jdbcType=TINYINT},
      </if>
      <if test="origin != null" >
        #{origin,jdbcType=VARCHAR},
      </if>
      <if test="freight != null" >
        #{freight,jdbcType=DOUBLE},
      </if>
      <if test="weight != null" >
        #{weight,jdbcType=DOUBLE},
      </if>
      <if test="logisticType != null" >
        #{logisticType,jdbcType=TINYINT},
      </if>
      <if test="priceRange != null" >
        #{priceRange,jdbcType=VARCHAR},
      </if>
      <if test="unit != null" >
        #{unit,jdbcType=VARCHAR},
      </if>
      <if test="source != null" >
        #{source,jdbcType=VARCHAR},
      </if>
      <if test="promotion != null" >
        #{promotion,jdbcType=VARCHAR},
      </if>
      <if test="idCard != null" >
        #{idCard,jdbcType=TINYINT},
      </if>
      <if test="startDate != null" >
        #{startDate,jdbcType=TIMESTAMP},
      </if>
      <if test="endDate != null" >
        #{endDate,jdbcType=TIMESTAMP},
      </if>
      <if test="bookingDate != null" >
        #{bookingDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isSale != null" >
        #{isSale,jdbcType=TINYINT},
      </if>
      <if test="wxisSale != null" >
        #{wxisSale,jdbcType=TINYINT},
      </if>
      <if test="isFind != null" >
        #{isFind,jdbcType=TINYINT},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="spec != null" >
        #{spec,jdbcType=VARCHAR},
      </if>
      <if test="model != null" >
        #{model,jdbcType=VARCHAR},
      </if>
      <if test="creator != null" >
        #{creator,jdbcType=VARCHAR},
      </if>
      <if test="modifier != null" >
        #{modifier,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        #{remark},
      </if>
      <if test="detail != null" >
        #{detail},
      </if>
    </trim>
  </insert>
  
  <!-- 更新 -->
   <update id="updateByIdSelective" parameterType="com.wangqin.globalshop.biz1.app.dal.dataObject.ItemDO" >
    update item
    <set >
      <trim suffixOverrides="," >
      <if test="itemCode != null" >
        item_code = #{itemCode,jdbcType=VARCHAR},
      </if>
      <if test="companyNo != null" >
        company_no = #{companyNo,jdbcType=VARCHAR},
      </if>
      <if test="categoryCode != null" >
        category_code = #{categoryCode,jdbcType=VARCHAR},
      </if>
      <if test="qrCodeUrl != null" >
        qr_code_url = #{qrCodeUrl,jdbcType=VARCHAR},
      </if>
      <if test="video != null" >
        video = #{video,jdbcType=VARCHAR},
      </if>
      <if test="subtitle != null" >
        subtitle = #{subtitle,jdbcType=VARCHAR},
      </if>
      <if test="itemName != null" >
        item_name = #{itemName,jdbcType=VARCHAR},
      </if>
      <if test="enName != null" >
        en_name = #{enName,jdbcType=VARCHAR},
      </if>
      <if test="itemShort != null" >
        item_short = #{itemShort,jdbcType=VARCHAR},
      </if>
      <if test="categoryName != null" >
        category_name = #{categoryName,jdbcType=VARCHAR},
      </if>
      <if test="saleType != null" >
        sale_type = #{saleType,jdbcType=TINYINT},
      </if>
      <if test="mainPic != null" >
        main_pic = #{mainPic,jdbcType=VARCHAR},
      </if>
      <if test="brandNo != null" >
        brand_no = #{brandNo,jdbcType=VARCHAR},
      </if>
      <if test="brandName != null" >
        brand_name = #{brandName,jdbcType=VARCHAR},
      </if>
      <if test="country != null" >
        country = #{country,jdbcType=TINYINT},
      </if>
      <if test="currency != null" >
        currency = #{currency,jdbcType=TINYINT},
      </if>
      <if test="origin != null" >
        origin = #{origin,jdbcType=VARCHAR},
      </if>
      <if test="freight != null" >
        freight = #{freight,jdbcType=DOUBLE},
      </if>
      <if test="weight != null" >
        weight = #{weight,jdbcType=DOUBLE},
      </if>
      <if test="logisticType != null" >
        logistic_type = #{logisticType,jdbcType=TINYINT},
      </if>
      <if test="priceRange != null" >
        price_range = #{priceRange,jdbcType=VARCHAR},
      </if>
      <if test="unit != null" >
        unit = #{unit,jdbcType=VARCHAR},
      </if>
      <if test="source != null" >
        source = #{source,jdbcType=VARCHAR},
      </if>
      <if test="promotion != null" >
        promotion = #{promotion,jdbcType=VARCHAR},
      </if>
      <if test="idCard != null" >
        id_card = #{idCard,jdbcType=TINYINT},
      </if>
      <if test="startDate != null" >
        start_date = #{startDate,jdbcType=TIMESTAMP},
      </if>
      <if test="endDate != null" >
        end_date = #{endDate,jdbcType=TIMESTAMP},
      </if>
      <if test="bookingDate != null" >
        booking_date = #{bookingDate,jdbcType=TIMESTAMP},
      </if>
      <if test="isSale != null" >
        is_sale = #{isSale,jdbcType=TINYINT},
      </if>
      <if test="wxisSale != null" >
        wxis_sale = #{wxisSale,jdbcType=TINYINT},
      </if>
      <if test="isFind != null" >
        is_find = #{isFind,jdbcType=TINYINT},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="spec != null" >
        spec = #{spec,jdbcType=VARCHAR},
      </if>
      <if test="model != null" >
        model = #{model,jdbcType=VARCHAR},
      </if>
      <if test="gmtModify != null" >
        gmt_modify = #{gmtModify,jdbcType=TIMESTAMP},
      </if>
      <if test="gmtCreate != null" >
        gmt_create = #{gmtCreate,jdbcType=TIMESTAMP},
      </if>
      <if test="isDel != null" >
        is_del = #{isDel,jdbcType=BIT},
      </if>
      <if test="creator != null" >
        creator = #{creator,jdbcType=VARCHAR},
      </if>
      <if test="modifier != null" >
        modifier = #{modifier,jdbcType=VARCHAR},
      </if>
      <if test="detail != null" >
        `detail` = #{detail},
      </if>
      <if test="remark != null" >
        `remark` = #{remark},
      </if>
      </trim>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  
    <!-- 根据条件查询商品总数量(fin)-->
	<select id="queryItemsCount" resultType="java.lang.Integer"  parameterType="com.wangqin.globalshop.biz1.app.vo.ItemQueryVO">
        SELECT
        	count(1)
        FROM
            item T1 LEFT JOIN inventory T3 ON T1.item_code=T3.item_code
        where
     		   T1.is_del=0
     		<!-- 
     		<if test="companyId != null">
     			and T1.company_id = #{companyId}
     		</if>
     		 -->
            <if test=" name != null and name != '' ">
                and T1.item_name LIKE concat('%',#{name},'%')
            </if>
            <if test=" itemCode != null and itemCode != '' ">
               and T1.item_code = #{itemCode}
            </if>
            <if test=" companyNo != null and companyNo != '' ">
                and T1.company_no = #{companyNo}
            </if>
            <!--  
             <if test=" enName != null and enName != '' ">
              and  T1.en_name LIKE concat('%',#{enName},'%')
            </if>
            -->
            <!--  
            <if test=" categoryId != null">
              and  T1.category_id = #{categoryId}
            </if>
            -->
            <if test=" brand != null and brand != ''">
              and  T1.brand_name = #{brand}
            </if>
            <!--  
            <if test=" buySite != null and buySite != ''">
              and  T1.buy_site = #{buySite}
            </if>
           
            <if test=" owners != null and owners != '' ">
              and  T1.owners LIKE concat('%',#{owners},'%')
            </if>
             -->
            <if test=" startDate!= null and endDate!= null">           	
             	and  (
             			(<![CDATA[  T1.start_date >= #{startDate} ]]> and <![CDATA[  T1.start_date <= #{endDate} ]]>)
             			or   
             			(<![CDATA[  T1.end_date >= #{startDate} ]]> and <![CDATA[  T1.end_date <= #{endDate} ]]>)
             		 )
            </if>           
            <if test="hasInventory > 0">
            	<![CDATA[and T3.inv > 0 ]]>
            </if>
            <if test="hasVirtualInventory > 0">
           		<![CDATA[and T3.virtual_inv > 0 ]]>
            </if>

    </select>
    
    <!-- 按条件查询商品(fin) -->
    <select id="queryItems" resultType="com.wangqin.globalshop.biz1.app.dto.ItemDTO" parameterType="com.wangqin.globalshop.biz1.app.vo.ItemQueryVO">
        SELECT
        	 <include refid="Base_Column_List_2" />
        FROM
            item T1  LEFT JOIN inventory T3 ON T1.item_code=T3.item_code
        where
     		    T1.is_del=0 
     		<if test="id != null">
     			and T1.id = #{id}
     		</if>
     		<!-- 
     		<if test="companyId != null">
     			and T1.company_id = #{companyId}
     		</if>
     		 -->
            <if test=" name != null and name != '' ">
                and T1.item_name LIKE concat('%',#{name},'%')
            </if>
            <if test=" itemCode != null and itemCode != '' ">
               and T1.item_code = #{itemCode}
            </if>
            <if test=" companyNo != null and companyNo != '' ">
                and T1.company_no = #{companyNo}
            </if>
            <!--  
             <if test=" enName != null and enName != '' ">
              and  T1.en_name LIKE concat('%',#{enName},'%')
            </if>
            -->
            <!--  
            <if test=" categoryId != null">
              and  T1.category_id = #{categoryId}
            </if>
            -->
            <if test=" brand != null and brand != ''">
              and  T1.brand_name = #{brand}
            </if>
            <!--  
            <if test=" buySite != null and buySite != ''">
              and  T1.buy_site = #{buySite}
            </if>
           
            <if test=" owners != null and owners != '' ">
              and  T1.owners LIKE concat('%',#{owners},'%')
            </if>-->
            <if test=" startDate!= null and endDate!= null">           	
             	and  (
             			(<![CDATA[  T1.start_date >= #{startDate} ]]> and <![CDATA[  T1.start_date <= #{endDate} ]]>)
             			or   
             			(<![CDATA[  T1.end_date >= #{startDate} ]]> and <![CDATA[  T1.end_date <= #{endDate} ]]>)
             		 )
            </if>  
            <if test="hasInventory > 0">
            	and <![CDATA[ T3.inv > 0 ]]>
            </if>
            <if test="hasVirtualInventory > 0">
           	and	<![CDATA[ T3.virtual_inv > 0 ]]>
            </if>
		order by T1.gmt_modify desc;
           
    </select>
    
    
    
    
    <!-- 根据id查询单个商品，修改时使用(fin) -->
    <select id="queryItemById" resultType="com.wangqin.globalshop.biz1.app.dto.ItemDTO" parameterType="java.lang.Long">
        SELECT
        	 <include refid="Base_Column_List_2" />
        FROM
            item T1 
        where
     		   T1.is_del=0
     		   AND T1.id=#{id}     
    </select>
    
    <select id="queryAllItemCodeAndIdHashMap" resultType="java.util.HashMap">
    		select 
    			id,
    			item_code AS "itemCode"
    		from 
    			item
    		order by id
    
    </select>
	
	<update id="updateItemNotSale" >
    	update item set is_sale=0 where <![CDATA[ (now()<start_date or now()>=date_sub(end_date,interval -1 day)) ]]> and is_sale!=0
	</update>
	<update id="updateItemSale" >
    	update item set is_sale=1 where <![CDATA[ now()>=start_date and now()<date_sub(end_date,interval -1 day) ]]> and is_sale!=1
	</update>
	
   <select id="queryItemsCountByhaihu" resultType="java.lang.Integer"  parameterType="com.wangqin.globalshop.biz1.app.vo.ItemQueryVO">
        SELECT
        	count(1)
        FROM
            item T1 LEFT JOIN item_sku T2 ON T1.id=T2.item_id
        where
     		   T1.third_sale = 1 
            <if test=" name != null and name != '' ">
                and T1.name LIKE concat('%',#{name},'%')
            </if>
            <if test=" itemCode != null and itemCode != '' ">
               and T1.item_code = #{itemCode}
            </if>
    </select>
    
	 <select id="queryHaihuItems" resultType="com.wangqin.globalshop.biz1.app.dal.dataObject.ItemDO" parameterType="com.wangqin.globalshop.biz1.app.vo.ItemQueryVO">
        SELECT
        	 <include refid="Haihu_Column_List" />,T2.sku_code As skuCode,T2.upc As skuUpc, T2.color As skuColor, T2.sale_price As salePrice,T2.weight As skuWeight
        FROM
            item T1 LEFT JOIN item_sku T2 ON T1.id=T2.item_id
        where
           T1.third_sale = 1 
             <if test=" name != null and name != '' ">
                and T1.name LIKE concat('%',#{name},'%')
            </if>
            <if test=" itemCode != null and itemCode != '' ">
               and T1.item_code = #{itemCode}
            </if>
          order by T1.gmt_create desc
          	<![CDATA[ LIMIT #{firstStart},#{pageSize} ]]>
            
    </select>
    
<select id="queryHaihuByUptime" resultMap="com.wangqin.globalshop.biz1.app.dal.mapper.ItemDOMapper.BaseResultMap" parameterType="com.wangqin.globalshop.biz1.app.vo.ItemQueryVO">
	SELECT
	<include refid="com.wangqin.globalshop.biz1.app.dal.mapper.ItemDOMapper.Base_Column_List" />
	FROM
	item T1 
	WHERE T1.third_sale = 1 
	<if test=" name != null and name != '' ">
		and T1.item_name LIKE concat('%',#{name},'%')
	</if>
	<if test=" itemCode != null and itemCode != '' ">
		and T1.item_code = #{itemCode}
	</if>
	 <if test=" gmtModify!= null ">
        and <![CDATA[  T1.gmt_modify >= #{gmtModify} ]]>
     </if>
	order by T1.gmt_create desc
</select>

<!-- 按照天统计上新量,XiaJun -->
	<select id="sumNewItemNumByDate" resultType="java.lang.Integer">
	SELECT IFNULL(count(1),0)
	FROM item T1 
	<where>
	1=1 
	AND	<![CDATA[ (TO_DAYS(NOW())-TO_DAYS(T1.gmt_create))=#{days} ]]> 
	</where>
	</select>

<!-- 按照月统计上新量,XiaJun -->
	<select id="sumNewItemNumByMonth" resultType="java.lang.Integer">
	SELECT IFNULL(count(1),0)
	FROM item T1
	<where>
	1=1 
		AND	<![CDATA[PERIOD_DIFF(DATE_FORMAT(NOW( ),'%Y%m'),DATE_FORMAT(T1.gmt_create,'%Y%m')) =#{months}]]>
	</where>
	</select>
	
	<select id="queryItemByItemCode" resultMap="com.wangqin.globalshop.biz1.app.dal.mapper.ItemDOMapper.BaseResultMap" >
	SELECT <include refid="com.wangqin.globalshop.biz1.app.dal.mapper.ItemDOMapper.Base_Column_List" />
	FROM item
	<where>
	item_code = #{itemCode}
	AND is_del=0
	</where>
	</select>

	
	<!--一键分享首页商品  -->
	<select id="queryItemByStatus" resultMap="com.wangqin.globalshop.biz1.app.dal.mapper.ItemDOMapper.BaseResultMap">
	SELECT
		<include refid="com.wangqin.globalshop.biz1.app.dal.mapper.ItemDOMapper.Base_Column_List" />
	FROM item T1
	<where>
	T1.company_no = #{companyNo}	
	AND
	T1.status = #{type}
	</where>
	<![CDATA[ LIMIT #{start}, #{pageSize}]]>
	</select>
    
    <!-- 一键分享搜索商品 -->
    <select id="queryItemByKeyWord"  resultMap="com.wangqin.globalshop.biz1.app.dal.mapper.ItemDOMapper.BaseResultMap">
    SELECT
    	<include refid="com.wangqin.globalshop.biz1.app.dal.mapper.ItemDOMapper.Base_Column_List"/>
    FROM item T1
    <where>
    T1.company_no = #{companyNo}
    AND
    T1.item_name 
    LIKE '%#{keyWord}%'
    ORDER BY T1.item_name asc,<!--按name字段升序 -->
        T1.id desc
		<![CDATA[ LIMIT #{start}, #{pageSize}]]>
    </where>
    </select>
    
    <!-- 一键分享商品详情 -->
    <select id="itemDetailByItemCode" resultMap="com.wangqin.globalshop.biz1.app.dal.mapper.ItemDOMapper.BaseResultMap">
    SELECT
    	<include refid="com.wangqin.globalshop.biz1.app.dal.mapper.ItemDOMapper.Base_Column_List"/>
    FROM item T1
    <where>
    T1.item_code = #{itemCode}
    AND
    T1.company_no = #{companyNo}
    </where>	
    </select>
    
    
    <!-- 一键分享，订单详情的商品图片 -->
    <select id="queryItemPicByItemCode" resultType="java.lang.String" parameterType="java.lang.String">
    	SELECT
    		main_pic
    	FROM item
    	<where>
    		item_code = #{itemCode}    
    	</where>	
    </select>
   

  <!-- 2.0版通用查询结果列,xiajun-->
  <sql id="Mall_Base_Column_List">
        T1.id,T1.item_name AS name,T1.status, T1.spec,T1.model,T1.country,T1.booking_date AS bookingDate,
        T1.category_name AS categoryName,T1.item_code AS itemCode,sale_type AS saleType,
        main_pic AS mainPic,qr_code_url AS dimensionCodePic,item_short AS itemShort,
        en_name AS enName,brand_name AS brand,currency,origin,weight,price_range as priceRange,
        unit,source,promotion,T1.id_card AS idCard,T1.detail,T1.start_date AS startDate,
        T1.end_date AS endDate,T1.is_sale AS isSale,T1.logistic_type as logisticType,
        T1.gmt_create AS gmtCreate,T1.gmt_modify AS gmtModify,T1.creator AS userCreate,
        T1.modifier AS userModify,T1.remark AS remark,T1.detail AS detail
    </sql>

  <!-- 按条件查询商品(fin) -->
  <select id="queryMallItems" resultType="com.wangqin.globalshop.biz1.app.dto.ItemDTO" parameterType="com.wangqin.globalshop.biz1.app.vo.ItemQueryVO">
    SELECT
    <include refid="Mall_Base_Column_List" />
    FROM
    item T1  LEFT JOIN inventory T3 ON T1.item_code=T3.item_code
    where
    T1.is_del=0
    <if test="id != null">
      and T1.id = #{id}
    </if>
    <!--
    <if test="companyId != null">
        and T1.company_id = #{companyId}
    </if>
     -->
    <if test=" name != null and name != '' ">
      and T1.item_name LIKE concat('%',#{name},'%')
    </if>
    <if test=" itemCode != null and itemCode != '' ">
      and T1.item_code = #{itemCode}
    </if>
    <if test=" companyNo != null and companyNo != '' ">
      and T1.company_no = #{companyNo}
    </if>
    <!--
     <if test=" enName != null and enName != '' ">
      and  T1.en_name LIKE concat('%',#{enName},'%')
    </if>
    -->
    <!--
    <if test=" categoryId != null">
      and  T1.category_id = #{categoryId}
    </if>
    -->
    <if test=" brand != null and brand != ''">
      and  T1.brand_name = #{brand}
    </if>
    <!--
    <if test=" buySite != null and buySite != ''">
      and  T1.buy_site = #{buySite}
    </if>

    <if test=" owners != null and owners != '' ">
      and  T1.owners LIKE concat('%',#{owners},'%')
    </if>-->
    <if test=" startDate!= null and endDate!= null">
      and  (
      (<![CDATA[  T1.start_date >= #{startDate} ]]> and <![CDATA[  T1.start_date <= #{endDate} ]]>)
      or
      (<![CDATA[  T1.end_date >= #{startDate} ]]> and <![CDATA[  T1.end_date <= #{endDate} ]]>)
      )
    </if>
    <if test=" startGmt!= null and endGmt!= null">
      and
      (<![CDATA[  T1.gmt_create >= #{startGmt} ]]> and <![CDATA[  T1.gmt_create <= #{endGmt} ]]>)

    </if>
    <if test="hasInventory > 0">
      and <![CDATA[ T3.inv > 0 ]]>
    </if>
    <if test="hasVirtualInventory > 0">
      and	<![CDATA[ T3.virtual_inv > 0 ]]>
    </if>
    order by T1.gmt_modify desc;

  </select>


  <select id="selectBatchIds" resultMap="com.wangqin.globalshop.biz1.app.dal.mapper.ItemDOMapper.ResultMapWithBLOBs" parameterType="java.util.ArrayList" >
    select
    <include refid="com.wangqin.globalshop.biz1.app.dal.mapper.ItemDOMapper.Base_Column_List" />
    ,
    <include refid="com.wangqin.globalshop.biz1.app.dal.mapper.ItemDOMapper.Blob_Column_List" />
    from item
    where id in
    <foreach collection="list" item="idList"  open="(" separator="," close=")">
      #{idList}
    </foreach>
  </select>



  <update id="updateBatchById" parameterType="java.util.List">
    update item set
    item_code=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.itemCode,jdbcType=VARCHAR}
    </foreach>
    ,company_no=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.companyNo,jdbcType=VARCHAR}
    </foreach>
    ,category_code=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.categoryCode,jdbcType=VARCHAR}
    </foreach>
    ,qr_code_url=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.qrCodeUrl,jdbcType=VARCHAR}
    </foreach>
    ,video=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.video,jdbcType=VARCHAR}
    </foreach>
    ,subtitle=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.subtitle,jdbcType=VARCHAR}
    </foreach>
    ,item_name=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.itemName,jdbcType=VARCHAR}
    </foreach>
    ,en_name=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.enName,jdbcType=VARCHAR}
    </foreach>
    ,item_short=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.itemShort,jdbcType=VARCHAR}
    </foreach>
    ,category_name=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.categoryName,jdbcType=VARCHAR}
    </foreach>
    ,sale_type=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.saleType,jdbcType=VARCHAR}
    </foreach>
    ,main_pic=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.mainPic,jdbcType=VARCHAR}
    </foreach>
    ,brand_no=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.brandNo,jdbcType=VARCHAR}
    </foreach>
    ,brand_name=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.brandName,jdbcType=VARCHAR}
    </foreach>
    ,country=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.country,jdbcType=VARCHAR}
    </foreach>
    ,currency=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.currency,jdbcType=TINYINT}
    </foreach>
    ,origin=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.origin,jdbcType=VARCHAR}
    </foreach>
    ,freight=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.freight,jdbcType=DOUBLE}
    </foreach>
    ,weight=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.weight,jdbcType=DOUBLE}
    </foreach>
    ,logistic_type=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.logisticType,jdbcType=TINYINT}
    </foreach>
    ,price_range=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.priceRange,jdbcType=VARCHAR}
    </foreach>
    ,unit=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.unit,jdbcType=VARCHAR}
    </foreach>
    ,source=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.source,jdbcType=VARCHAR}
    </foreach>
    ,promotion=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.promotion,jdbcType=VARCHAR}
    </foreach>
    ,id_card=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.idCard,jdbcType=TINYINT}
    </foreach>
    ,start_date=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.startDate,jdbcType=TIMESTAMP}
    </foreach>
    ,end_date=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.endDate,jdbcType=TIMESTAMP}
    </foreach>
    ,booking_date=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.bookingDate,jdbcType=TIMESTAMP}
    </foreach>
    ,is_sale=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.isSale,jdbcType=TINYINT}
    </foreach>
    ,wxis_sale=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.wxisSale,jdbcType=TINYINT}
    </foreach>
    ,is_find=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.isFind,jdbcType=TINYINT}
    </foreach>
    ,status=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.status,jdbcType=INTEGER}
    </foreach>
    ,spec=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.spec,jdbcType=VARCHAR}
    </foreach>
    ,model=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.model,jdbcType=VARCHAR}
    </foreach>
    ,creator=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.creator,jdbcType=VARCHAR}
    </foreach>
    ,modifier=
    <foreach collection="list" item="item" index="index" separator=" " open="case ID" close="end">
      when #{item.id,jdbcType=BIGINT} then #{item.modifier,jdbcType=VARCHAR}
    </foreach>


    where id in
    <foreach collection="list" index="index" item="item" separator="," open="(" close=")">
      #{item.id,jdbcType=BIGINT}
    </foreach>

  </update>

</mapper>
