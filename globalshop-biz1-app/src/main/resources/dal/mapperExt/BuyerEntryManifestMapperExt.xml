<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wangqin.mapper.TaskDailyOrderMapper">
	<sql id="Base_Column_List">
		T1.sku_id AS skuId,T1.item_id AS itemId,T1.upc,T1.sku_code AS skuCode,T1.item_name AS itemName,T1.brand,T1.category_name AS categoryName,T1.sku_pic AS skuPic,T1.color,T1.scale,T1.buy_site AS buySite,T1.currently_date AS currentlyDate,T1.sale_need AS saleNeed,T1.purchase_need AS purchaseNeed,T1.inventory,T1.trans_inv AS transInv,T1.virtual_inv AS virtualInv,T1.locked_inv AS lockedInv,T1.locked_trans_inv AS lockedTransInv,T1.gmt_create AS gmtCreate,T1.gmt_modify AS gmtModify
	</sql>
    
    <select id="queryTaskDailyDetailByOrder"  resultType="com.wangqin.model.TaskDailyOrder">
    	SELECT a.sku_id AS skuId,a.sale_need AS saleNeed,b.sku_code AS skuCode,b.item_id AS itemId,b.upc,b.item_name AS itemName,b.brand,b.category_name AS categoryName,b.sku_pic AS skuPic,b.color,b.scale,b.buy_site AS buySite,c.inventory,c.trans_inv AS transInv,c.virtual_inv AS virtualInv,c.locked_inv AS lockedInv,c.locked_trans_inv AS lockedTransInv,
    	case b.scale 
		 WHEN 'XXS' THEN 1 
		 WHEN 'XS' THEN 2 
		 WHEN 'S' THEN 3 
		 WHEN 'M' THEN 4 
		 WHEN 'L' THEN 5 
		 WHEN 'XL' THEN 6 
		 WHEN 'XXL' THEN 7 
		end  as scale_int 
		FROM (SELECT sku_id,sum(`quantity`) sale_need  FROM erp_order WHERE status=0 group by sku_id) a 
		LEFT JOIN item_sku b ON a.sku_id=id  
		LEFT JOIN inventory c ON a.sku_id=c.sku_id 
		ORDER BY IFNULL(b.buy_site, ''),trim(b.item_name),b.color,(b.scale+0),scale_int
    </select>
    
    <select id="queryItemSkusCount" resultType="java.lang.Integer"  parameterType="com.wangqin.vo.ItemSkuQueryVO">
        SELECT 
        	count(1) 
        FROM 
            task_daily_order T1 
        WHERE 1=1 
            <if test=" itemName != null and itemName != '' ">
                and T1.item_name LIKE concat('%',#{itemName},'%') 
            </if>
            <if test=" buySite != null and buySite != '' ">
          		and T1.buy_site LIKE concat('%',#{buySite},'%') 
            </if>
    </select>
    
    <!-- 返回类型为itemSku，所以转sku_id为id -->
    <select id="queryItemSkus" resultType="com.wangqin.model.ItemSku" parameterType="com.wangqin.vo.ItemSkuQueryVO">
        SELECT
        	 <include refid="Base_Column_List"/>,T1.sku_id AS id  
        FROM
            task_daily_order T1 
        WHERE 1=1 
        	<if test=" itemName != null and itemName != '' ">
                and T1.item_name LIKE concat('%',#{itemName},'%')
            </if>
            <if test=" buySite != null and buySite != '' ">
          		and T1.buy_site LIKE concat('%',#{buySite},'%') 
            </if>
        <![CDATA[ LIMIT #{firstStart},#{pageSize} ]]>
    </select>
    
    <select id="queryAll" resultType="com.wangqin.model.TaskDailyOrder">
        SELECT 
        	 <include refid="Base_Column_List"/> 
        FROM 
            task_daily_order T1 
    </select>
    
</mapper>