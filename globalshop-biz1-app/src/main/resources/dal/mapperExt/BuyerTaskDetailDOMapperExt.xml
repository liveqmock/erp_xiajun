<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wangqin.globalshop.biz1.app.dal.mapperExt.BuyerTaskDetailDOMapperExt">


    <insert id="inserBatch" parameterType="java.util.List">
        <selectKey resultType="java.lang.Long" keyProperty="id" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into buyer_task_detail(
        buyer_task_no,
        item_code,
        upc,
        max_price,
        start_time,
        end_time,
        mode,
        sku_code,
        remark,
        max_count,
        sku_pic_url,
        creator,
        modifier,
        company_no
        )
        VALUES
        <foreach collection="list" item="detail" separator=",">
            (
            #{detail.buyerTaskNo},
            #{detail.itemCode},
            #{detail.upc},
            #{detail.maxPrice},
            #{detail.startTime},
            #{detail.endTime},
            #{detail.mode},
            #{detail.skuCode},
            #{detail.remark},
            #{detail.maxCount},
            #{detail.skuPicUrl},
            #{detail.creator},
            #{detail.modifier},
            #{detail.companyNo}
            )
        </foreach>
    </insert>

    <update id="updateTaskDetailDailyStatus" >
        UPDATE buyer_task_detail
        SET status=#{status}
        WHERE buyer_task_no = #{buyerTaskNo}
    </update>


    <select id="taskDailyExportByTaskNo" resultType="com.wangqin.globalshop.biz1.app.dal.dataObject.ItemSkuDO" parameterType="java.lang.String">
        SELECT b.item_name as itemName,b.sku_pic as skuPic,b.sku_code as skuCode,b.upc,b.brand_name as brand,b.scale,a.count,c.title as taskTitle,c.gmt_create as gmtCreate,c.buyer_task_no as taskOrderNo,entry_count as inCount,
        case b.scale
        WHEN 'XXS' THEN 1
        WHEN 'XS' THEN 2
        WHEN 'S' THEN 3
        WHEN 'M' THEN 4
        WHEN 'L' THEN 5
        WHEN 'XL' THEN 6
        WHEN 'XXL' THEN 7
        end as scale_int
        FROM buyer_task_detail a
        LEFT JOIN item_sku b ON a.sku_code=b.sku_code
        LEFT JOIN buyer_task c ON a.buyer_task_no=c.buyer_task_no
        WHERE a.buyer_task_no=#{buyerTaskNo}
        ORDER BY trim(b.item_name),(b.scale+0),scale_int
    </select>

</mapper>
